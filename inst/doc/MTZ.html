<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Read and analyse an MTZ file</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Read and analyse an MTZ file</h1>



<!-- Block with global markdown options

-->
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Main aim of this tutorial is to load the full content of an MTZ file in the workspace, to analyse and modify data, and to write the modified content into a new MTZ file.</p>
</div>
<div id="sample-mtz-file" class="section level2">
<h2>Sample MTZ file</h2>
<p>Some sample files are stored as external data in this package. These are the MTZ files available with the current release. To access the file, first load the <code>cry</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cry)</span></code></pre></div>
<p>Next, have a look at what is included in the external-data directory of <code>cry</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>datadir <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>,<span class="at">package=</span><span class="st">&quot;cry&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>all_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(datadir)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(all_files)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;1dei-sf.cif&quot;               &quot;1dei_phases.mtz&quot;          </span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [3] &quot;2ol9_phases.mtz&quot;           &quot;6vww_xds_ascii_merged.hkl&quot;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;AMS_DATA.cif&quot;              &quot;e-65-00i60-Isup2.rtv&quot;     </span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [7] &quot;shelxc.log&quot;                &quot;shelxd.log&quot;               </span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;shelxe_i.log&quot;              &quot;shelxe_o.log&quot;             </span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [11] &quot;xds00_ascii.hkl&quot;</span></span></code></pre></div>
<p>We are interested in the MTZ file “1dei_phases.mtz”. This file can be loaded using function <code>readMTZ</code>.</p>
</div>
<div id="the-structure-of-an-mtz-file-in-r" class="section level2">
<h2>The structure of an MTZ file in R</h2>
<p>Let’s load “1dei_phases.mtz” in memory. The created object is a named list.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">&lt;-</span> <span class="fu">file.path</span>(datadir,<span class="st">&quot;1dei_phases.mtz&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>objMTZ <span class="ot">&lt;-</span> <span class="fu">readMTZ</span>(filename)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in readChar(f, 4): truncating string with embedded nuls</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(objMTZ)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;list&quot;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(objMTZ)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;reflections&quot;  &quot;header&quot;       &quot;batch_header&quot;</span></span></code></pre></div>
<p>Each component of  is either a named list, or a data frame. More specifically:</p>
<ol style="list-style-type: decimal">
<li><p><code>reflections</code></p>
<p>It’s a data frame. It contains the actual x-ray diffraction data from a given crystal.</p></li>
<li><p><code>header</code></p>
<p>It’s a named list. It contains information on the crystal used to obtain the x-ray diffraction data and on the diffraction experiment, in general.</p></li>
<li><p><code>batch_header</code> It’s a named list. It gets filled only when the MTZ file<br />
includes so-called “unmerged” data.</p></li>
</ol>
<p>For the merged MTZ file we are exploring in this tutorial, the <code>batch_header</code> is <code>NULL</code>.</p>
</div>
<div id="the-mtz-header" class="section level2">
<h2>The MTZ <code>header</code></h2>
<p>This is a named list. The names hint at the content of the specific components.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>hdr <span class="ot">&lt;-</span> objMTZ<span class="sc">$</span>header</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(hdr)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;list&quot;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(hdr)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;TITLE&quot;   &quot;NCOL&quot;    &quot;CELL&quot;    &quot;SORT&quot;    &quot;SYMINF&quot;  &quot;RESO&quot;    &quot;NDIF&quot;   </span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [8] &quot;SYMM&quot;    &quot;PROJECT&quot; &quot;CRYSTAL&quot; &quot;DATASET&quot; &quot;DCELL&quot;   &quot;DWAVEL&quot;  &quot;COLUMN&quot; </span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [15] &quot;COLSRC&quot;</span></span></code></pre></div>
<p>For example, <code>NCOL</code> is the number of columns of the <code>reflections</code> data frame, <code>CELL</code> contains the crystal unit cell parameters and <code>SYMM</code> includes information on the crystal symmetry.</p>
A merged MTZ file stores reflections x-ray data in a hierarchical way. The main purpose of collecting x-ray data is to determine the 3D structure of the molecule arranged in an ordered crystallographic lattice. Reflections related to a same molecule can come from different crystals. Different datasets, corresponding to different rotation sweeps from the same crystal, can be related to a crystal. Each MTZ file can thus include data from several crystals, each crystal giving origin to several datasets. Normally, a single MTZ file will be part of a same project, but this does not necessarily have to be the case. In summary, the hierarchy defining each dataset is:
<center>
<em>Project</em> <span class="math inline">\(\quad\Rightarrow\quad\)</span> <em>Crystal</em> <span class="math inline">\(\quad\Rightarrow\quad\)</span> <em>Dataset</em>
</center>
<p>For the file loaded we find:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(objMTZ<span class="sc">$</span>header<span class="sc">$</span>PROJECT)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   id      pname</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  0   HKL_base</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  1 sf_convert</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(objMTZ<span class="sc">$</span>header<span class="sc">$</span>CRYSTAL)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   id    cname</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  0 HKL_base</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  1  cryst_1</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(objMTZ<span class="sc">$</span>header<span class="sc">$</span>DATASET)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   id    dname</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  0 HKL_base</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  1   data_1</span></span></code></pre></div>
<p>The only dataset in this MTZ file is called <em>data_1</em>. It was obtained from x-ray diffraction of a crystal called <em>cryst_1</em>. This crystal is one of the samples belonging to a project called <em>sf_convert</em>. All MTZ files contain, by default, a dataset <em>HKL_base</em> which comes from the crystal <em>HKL_base</em>, which is part of the project <em>HKL_base</em>; this peculiar project is always present to make sure that data observations made only of the Miller indices, are always included. More information on the header’s content can be read in the documentation for <code>readMTZ</code> or <code>readMTZHeader</code>.</p>
</div>
<div id="the-mtz-reflections" class="section level2">
<h2>The MTZ <code>reflections</code></h2>
<p>Data are actually contained in this component. It is a data frame whose columns have the names found in the header component <code>COLUMN[,1]</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>objMTZ<span class="sc">$</span>header<span class="sc">$</span>COLUMN[,<span class="dv">1</span>]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;H&quot;           &quot;K&quot;           &quot;L&quot;           &quot;FP&quot;          &quot;SIGFP&quot;      </span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [6] &quot;FC&quot;          &quot;PHIC&quot;        &quot;FC_ALL&quot;      &quot;PHIC_ALL&quot;    &quot;FWT&quot;        </span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [11] &quot;PHWT&quot;        &quot;DELFWT&quot;      &quot;PHDELWT&quot;     &quot;FOM&quot;         &quot;FC_ALL_LS&quot;  </span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [16] &quot;PHIC_ALL_LS&quot;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>objMTZ<span class="sc">$</span>reflections[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   H K  L        FP     SIGFP        FC PHIC    FC_ALL PHIC_ALL       FWT PHWT</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0 0  4 420.23508 48.025589 411.46274    0 441.54556        0 398.92459    0</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 0 0  6 784.55963 53.490089 719.30823  180 780.32288      180 788.79639  180</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 0 0  8 266.88480 18.889168 156.35133    0 145.58990      360 388.17963  360</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 0 0 10  60.62275 21.459837  79.47448    0  82.45022        0  30.81676    0</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 0 0 14  94.31614  5.330165  42.39147    0  46.47320      360 142.01843  360</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       DELFWT PHDELWT       FOM FC_ALL_LS PHIC_ALL_LS</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  42.620972     180 1.0000000 460.96564           0</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2   8.473511     180 1.0000000 743.42645         180</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 242.589722     360 0.9999999 145.39508         360</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  51.633461     180 0.9341952  81.84018           0</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  95.545235     360 0.9992544  42.30125         360</span></span></code></pre></div>
<p>A data frame is the appropriate class for observations like the crystallographic x-ray data. One reason for this is, for instance, that grouping or selection according to a specific criterion can be carried out very easily with a data frame. Let us, as an example, select part of the data using a condition on the Miller indices. We can be interested to select reflections for which <span class="math inline">\(h\)</span> has a specific value; this is shown in the following chunk of code.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List the different values of H</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(objMTZ<span class="sc">$</span>reflections<span class="sc">$</span>H)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1]  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [26] 25 26 27 28 29 30 31 32 33 34 35</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Select all reflections with H=1</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">which</span>(objMTZ<span class="sc">$</span>reflections<span class="sc">$</span>H <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(idx)  <span class="co"># 373 reflections have H=0</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 373</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Save these reflections in a different object</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>refs <span class="ot">&lt;-</span> objMTZ<span class="sc">$</span>reflections[idx,]</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the first 10 selected reflections</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>refs[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     H K  L        FP     SIGFP        FC         PHIC    FC_ALL     PHIC_ALL</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 338 1 0  4  69.46197  7.137606  67.48492 1.800000e+02  38.35452 1.800000e+02</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 339 1 0  5  55.82940  1.932214 137.18262 9.000000e+01 120.74961 8.999999e+01</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 340 1 0  6 296.25644 22.226982 283.05109 3.617508e-06 302.89392 2.897944e-06</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 341 1 0  7 294.59216 23.033159 276.94324 2.700000e+02 294.35089 2.700000e+02</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 342 1 0  8  77.35909  3.981911  69.41461 2.083899e-06  64.56831 2.083780e-06</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 343 1 0  9  46.07975  4.606244  32.10196 2.700001e+02  30.71046 2.700001e+02</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 344 1 0 12 118.85085  2.718317  90.03316 0.000000e+00  94.01305 0.000000e+00</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 345 1 0 13  56.22640  4.300251  56.44312 8.999997e+01  53.37141 8.999997e+01</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 346 1 0 14  52.02279  4.389729  70.51323 1.800000e+02  77.82328 1.800000e+02</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 347 1 1  3 292.26788 26.617142 374.87027 1.705684e+02 279.07269 1.674537e+02</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           FWT         PHWT      DELFWT      PHDELWT       FOM FC_ALL_LS</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 338  39.99242 1.800000e+02   1.6379013 1.800000e+02 0.5639557  50.18671</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 339  12.13563 2.700000e+02 132.8852386 2.700000e+02 0.9727311 127.82761</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 340 289.61896 2.897945e-06  13.2749634 1.800000e+02 1.0000000 290.93329</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 341 294.83344 2.700000e+02   0.4825439 2.700000e+02 1.0000000 268.81738</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 342  87.53786 2.083780e-06  22.9695587 2.083780e-06 0.9831176  73.09277</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 343  32.66603 2.700001e+02   1.9555779 2.700001e+02 0.6876827  31.74592</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 344 143.68866 0.000000e+00  49.6756134 0.000000e+00 1.0000000  90.22993</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 345  59.07624 8.999997e+01   5.7048264 8.999997e+01 0.9999542  56.48866</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 346  26.22218 1.800000e+02  51.6010971 8.662659e-06 0.9999989  70.44583</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 347 294.21536 1.674537e+02  15.1426640 1.674536e+02 0.9807579 297.09183</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      PHIC_ALL_LS</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 338 1.800000e+02</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 339 8.999999e+01</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 340 3.346423e-06</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 341 2.700000e+02</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 342 1.979033e-06</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 343 2.700001e+02</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 344 0.000000e+00</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 345 8.999997e+01</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 346 1.800000e+02</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 347 1.674240e+02</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Find out the range of FP/sigFP for the selected reflections</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(refs<span class="sc">$</span>FP<span class="sc">/</span>refs<span class="sc">$</span>SIGFP)</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1]  2.374856 56.249997</span></span></code></pre></div>
<p>Clearly, a lot of different operations and investigations can be carried out on the selected data. A second example involves data for which the signal-to-noise ratio (FP/sigFP) is greater than 1, as shown in the following snippet.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">which</span>(objMTZ<span class="sc">$</span>reflections<span class="sc">$</span>FP<span class="sc">/</span>objMTZ<span class="sc">$</span>reflections<span class="sc">$</span>SIGFP <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(idx) <span class="co"># 8377 reflections have FP/sigFP &gt;= 1</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 8377</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The reflections can be extracted</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>refs <span class="ot">&lt;-</span> objMTZ<span class="sc">$</span>reflections[idx,]</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram of I/sigI</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(refs<span class="sc">$</span>FP<span class="sc">/</span>refs<span class="sc">$</span>SIGFP,<span class="at">breaks=</span><span class="dv">30</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;FP/sigFP&quot;</span>,<span class="at">xlab=</span><span class="st">&quot;FP/sigFP&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>A third example is related to the reflections’ resolution. Once it has been calculated (cell parameters are needed to do that), data can be selected within a given resolution range (a so-called <em>resolution shell</em>). There is a function in <code>cry</code>, called <code>hkl_to_reso</code>, which calculates the resolution in angstroms for a reflection of Miller indices <span class="math inline">\(h, k, l\)</span>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract cell parameters from header</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>cpars <span class="ot">&lt;-</span> objMTZ<span class="sc">$</span>header<span class="sc">$</span>CELL</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cpars)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 57.4 56.3 23.0 90.0 90.0 90.0</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> cpars[<span class="dv">1</span>]; b <span class="ot">&lt;-</span> cpars[<span class="dv">2</span>]; c <span class="ot">&lt;-</span> cpars[<span class="dv">3</span>]</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>aa <span class="ot">&lt;-</span> cpars[<span class="dv">4</span>]; bb <span class="ot">&lt;-</span> cpars[<span class="dv">5</span>]; cc <span class="ot">&lt;-</span> cpars[<span class="dv">6</span>]</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolution of reflection (1,0,0) (0,1,0) (0,0,1)</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">hkl_to_reso</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,a,b,c,aa,bb,cc)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 57.4</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="fu">hkl_to_reso</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,a,b,c,aa,bb,cc)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 56.3</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="fu">hkl_to_reso</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,a,b,c,aa,bb,cc)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 23</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Reflections with higher Miller indices have higher resolutions</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="fu">hkl_to_reso</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">0</span>,a,b,c,aa,bb,cc)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 5.74</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="fu">hkl_to_reso</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">20</span>,a,b,c,aa,bb,cc)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.127592</span></span></code></pre></div>
<p>Once resolutions are calculated (and the calculation is done on data having the same order as the original reflections), data within a given resolution shell can be selected.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>resos <span class="ot">&lt;-</span> <span class="fu">hkl_to_reso</span>(objMTZ<span class="sc">$</span>reflections<span class="sc">$</span>H,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                     objMTZ<span class="sc">$</span>reflections<span class="sc">$</span>K,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                     objMTZ<span class="sc">$</span>reflections<span class="sc">$</span>L,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                     a,b,c,aa,bb,cc)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolution range for all data</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(resos)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.600050 9.981333</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Select data with resolution between 5 and 9 angstroms</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">which</span>(resos <span class="sc">&gt;=</span> <span class="dv">5</span> <span class="sc">&amp;</span> resos <span class="sc">&lt;=</span> <span class="dv">9</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(idx)  <span class="co"># Only 314 reflections</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 314</span></span></code></pre></div>
</div>
<div id="output-to-a-new-mtz-file" class="section level2">
<h2>Output to a new MTZ file</h2>
<p>In order to investigate specific ideas it might be worth to modify the observations in a specific way and to write them out to a new MTZ file to be later handled by the tools proper of the <a href="https://www.ccp4.ac.uk">CCP4</a> family of programs for crystallography. The <code>cry</code> function to write reflections content to an MTZ file is called <code>writeMTZ</code>. In order to make this a flexible function, it has been deemed appropriate to take as input the three named lists returned by <code>readMTZ</code>. These will have been changed by the user, prior to use with <code>writeMTZ</code>. By default, the MTZ file title is left unchanged and the <code>batch_header</code> list is set to <code>NULL</code>; thus by default the MTZ file is assumed to be a merged-reflections file. Special attention will have to be devoted to parts of the <code>header</code> list, which store information on the observations. These are, for instance, <code>NCOL</code>, <code>SORT</code>, <code>RESO</code>, <code>COLUMN</code>, etc. An example can help to clarify this concept.</p>
<p>A typical modifications of the observed data is when high-resolution reflections are eliminated. This means that the number of reflections and other quantities in the <code>header</code> will have to be changed.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy original data to 2 separate lists</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>refs <span class="ot">&lt;-</span> objMTZ<span class="sc">$</span>reflections</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>hdr <span class="ot">&lt;-</span> objMTZ<span class="sc">$</span>header</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(refs[,<span class="dv">1</span>])  <span class="co"># Number of reflections before cut</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 8377</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(hdr<span class="sc">$</span>NCOL[<span class="dv">2</span>])</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 8377</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Cut data to 5 angstroms resolution</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># (see previous chunk of code for resos)</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">which</span>(resos <span class="sc">&gt;=</span> <span class="dv">5</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>refs <span class="ot">&lt;-</span> refs[idx,]</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(refs[,<span class="dv">1</span>])  <span class="co"># Now there are only 333 observations</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 333</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Modify specific parts of header</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>hdr<span class="sc">$</span>NCOL[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">length</span>(refs[,<span class="dv">1</span>])            <span class="co"># Number of reflections</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>hdr<span class="sc">$</span>RESO <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">range</span>(resos[idx])<span class="sc">^</span><span class="dv">2</span>)    <span class="co"># Resolution range</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>hdr<span class="sc">$</span>DATASET[<span class="dv">2</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Data cut to 5A&quot;</span>  <span class="co"># Dataset</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>obsmin <span class="ot">&lt;-</span> <span class="fu">apply</span>(refs,<span class="dv">2</span>,min,<span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>obsmax <span class="ot">&lt;-</span> <span class="fu">apply</span>(refs,<span class="dv">2</span>,max,<span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>hdr<span class="sc">$</span>COLUMN[,<span class="dv">3</span>] <span class="ot">&lt;-</span> obsmin                   <span class="co"># COLUMN</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>hdr<span class="sc">$</span>COLUMN[,<span class="dv">4</span>] <span class="ot">&lt;-</span> obsmax</span></code></pre></div>
<p>The data frame <code>COLSRC</code> contains the date and time at which the specific data columns have been generated. This can be changed with the <code>cry</code> function <code>change_COLSRC</code>; the new date and time is the current one.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Original COLSRC</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(hdr<span class="sc">$</span>COLSRC)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         labels                     created id</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1            H CREATED_11/10/2017_01:55:14  0</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2            K CREATED_11/10/2017_01:55:14  0</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3            L CREATED_11/10/2017_01:55:14  0</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4           FP CREATED_11/10/2017_01:55:14  1</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5        SIGFP CREATED_11/10/2017_01:55:14  1</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6           FC CREATED_11/10/2017_01:55:14  1</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7         PHIC CREATED_11/10/2017_01:55:14  1</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8       FC_ALL CREATED_11/10/2017_01:55:14  1</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 9     PHIC_ALL CREATED_11/10/2017_01:55:14  1</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10         FWT CREATED_11/10/2017_01:55:14  1</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11        PHWT CREATED_11/10/2017_01:55:14  1</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12      DELFWT CREATED_11/10/2017_01:55:14  1</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 13     PHDELWT CREATED_11/10/2017_01:55:14  1</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 14         FOM CREATED_11/10/2017_01:55:14  1</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 15   FC_ALL_LS CREATED_11/10/2017_01:55:14  1</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 16 PHIC_ALL_LS CREATED_11/10/2017_01:55:14  1</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Change date and time</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>hdr <span class="ot">&lt;-</span> <span class="fu">change_COLSRC</span>(hdr)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co"># New COLSRC</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(hdr<span class="sc">$</span>COLSRC)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         labels                     created id</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1            H CREATED_02/05/2021_10:26:46  0</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2            K CREATED_02/05/2021_10:26:46  0</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3            L CREATED_02/05/2021_10:26:46  0</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4           FP CREATED_02/05/2021_10:26:46  1</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5        SIGFP CREATED_02/05/2021_10:26:46  1</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6           FC CREATED_02/05/2021_10:26:46  1</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7         PHIC CREATED_02/05/2021_10:26:46  1</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8       FC_ALL CREATED_02/05/2021_10:26:46  1</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 9     PHIC_ALL CREATED_02/05/2021_10:26:46  1</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10         FWT CREATED_02/05/2021_10:26:46  1</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11        PHWT CREATED_02/05/2021_10:26:46  1</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12      DELFWT CREATED_02/05/2021_10:26:46  1</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 13     PHDELWT CREATED_02/05/2021_10:26:46  1</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 14         FOM CREATED_02/05/2021_10:26:46  1</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 15   FC_ALL_LS CREATED_02/05/2021_10:26:46  1</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 16 PHIC_ALL_LS CREATED_02/05/2021_10:26:46  1</span></span></code></pre></div>
<p>Once all changes have been done, the list components are ready to be saved out to a new MTZ file called, in this specific instance, “new.mtz”.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Temporary directory for output</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>tdir <span class="ot">&lt;-</span> <span class="fu">tempdir</span>()</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(tdir,<span class="st">&quot;new.mtz&quot;</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Write changed data to the new MTZ file</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">writeMTZ</span>(refs,hdr,fname,<span class="at">title=</span><span class="st">&quot;New truncated dataset&quot;</span>)</span></code></pre></div>
<p>Data from the new MTZ file can either be explored using CCP4 programs, or read back into R using again <code>readMTZ</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read data from &quot;new.mtz&quot;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>newMTZ <span class="ot">&lt;-</span> <span class="fu">readMTZ</span>(fname,<span class="cn">TRUE</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in readChar(f, 4): truncating string with embedded nuls</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;COLUMN  H                             H                 0                11    0&quot;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;COLUMN  K                             H                 0                11    0&quot;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;COLUMN  L                             H                 0                 4    0&quot;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;COLUMN  FP                            F            12.105          1095.345    1&quot;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;COLUMN  SIGFP                         Q             1.365            96.585    1&quot;</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;COLUMN  FC                            F             5.035          1055.738    1&quot;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;COLUMN  PHIC                          P                 0               360    1&quot;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;COLUMN  FC_ALL                        F             1.210          1136.601    1&quot;</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;COLUMN  PHIC_ALL                      P                 0               360    1&quot;</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;COLUMN  FWT                           F             0.133          1054.090    1&quot;</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;COLUMN  PHWT                          P                 0               360    1&quot;</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;COLUMN  DELFWT                        F             0.070           393.415    1&quot;</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;COLUMN  PHDELWT                       P                 0               360    1&quot;</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;COLUMN  FOM                           W             0.023             1.000    1&quot;</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;COLUMN  FC_ALL_LS                     F             1.537          1171.841    1&quot;</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;COLUMN  PHIC_ALL_LS                   P                 0               360    1&quot;</span></span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
